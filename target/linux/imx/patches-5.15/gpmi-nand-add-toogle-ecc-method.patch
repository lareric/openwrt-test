From e9402bde7ab689a2478b2eade304506771a5cccc Mon Sep 17 00:00:00 2001
From: lareric <seiji255@outlook.com>
Date: Fri, 15 Mar 2024 17:21:14 +0800
Subject: [PATCH] add toggle to switch between chip->ecc and req->ecc

---
 drivers/mtd/nand/raw/gpmi-nand/gpmi-nand.c | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/drivers/mtd/nand/raw/gpmi-nand/gpmi-nand.c b/drivers/mtd/nand/raw/gpmi-nand/gpmi-nand.c
index aef722dfdef5f..f18b648c371e2 100644
--- a/drivers/mtd/nand/raw/gpmi-nand/gpmi-nand.c
+++ b/drivers/mtd/nand/raw/gpmi-nand/gpmi-nand.c
@@ -517,9 +517,10 @@ static int common_nfc_set_geometry(struct gpmi_nand_data *this)
 	const struct nand_ecc_props *requirements =
 		nanddev_get_ecc_requirements(&chip->base);
 
-	if (chip->ecc.strength > 0 && chip->ecc.size > 0)
-		return set_geometry_by_ecc_info(this, chip->ecc.strength,
-						chip->ecc.size);
+	if ((of_property_read_bool(this->dev->of_node, "fsl,use-chip-default-ecc"))
+		if (chip->ecc.strength > 0 && chip->ecc.size > 0)
+			return set_geometry_by_ecc_info(this, chip->ecc.strength,
+							chip->ecc.size);
 
 	if ((of_property_read_bool(this->dev->of_node, "fsl,use-minimum-ecc"))
 				|| legacy_set_geometry(this)) {
